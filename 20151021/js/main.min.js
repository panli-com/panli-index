var CrawlerProduct={init:function(){var t={zoomType:"standard",lens:!0,preloadImages:!0,alwaysOn:!1,zoomWidth:250,zoomHeight:250,zoomHeightFun:function(){return $("#JqzoomImg").height()},zoomWidthFun:function(){return $("#JqzoomImg").width()},xOffset:10,yOffset:-1,position:"right",disableZoomAttributeDomID:"JqzoomImg",title:!1};$(".jqzoom").jqzoom(t)}};$(function(){CrawlerProduct.init(),Product.Init()});var Product={snatchData:{},Init:function(){this.snatchData=crawlProduct,crawlProduct.DiscountPrice<=0&&(crawlProduct.DiscountPrice=crawlProduct.Price),this.goodsList.init(),this.skuGroup.init(),this.method(),this.Freight()},Freight:function(){var t=this.snatchData;if(t.Freight<0){$("#DetailsC_Freight").removeAttr("disabled").removeClass("addpanel_hui").addClass("amc_inputInit");var i=$('<div class="DetailsC_isFreight"><span>请填写商品到上海的运费</span><div><em></em></div></div>').hover(function(){$("div,span",this).show()},function(){$("div,span",this).hide()});$("#DetailsC_Freight").val("").before(i)}},numbers:{isNumbers:function(t,i,a){return this.digital({dom:t[0]}),i?this.quantity(t,a):"",!1},digital:function(t){var i={dom:document,price:!1,keyup:function(){}};i=$.extend(i,t);var a=i.dom,e=i.price,r=i.keyup;a.style.imeMode="disabled",a.onkeydown=function(t){var i=window.event||t,a=i.charCode?i.charCode:i.keyCode,r=this.value;return i.shiftKey||!(a>=48&&57>=a||8==a||a>=96&&105>=a||e&&(190==a||110==a)&&r.indexOf(".")<0&&0!=r.length)?!1:void 0},a.onkeyup=function(){var t=e?/[^\d\.]/g:/[^\d]/g,i=this.value.replace(t,"");return this.value=i,r(this),!1}},quantity:function(t,i){var a=!1,e=this;t.blur(function(){var a=this.value.match(/^\d+/);(!a||parseInt(a)<=0)&&(a=this.value=1),parseInt(a)<=1?t.prev().addClass("Hui"):t.prev().removeClass("Hui"),i?e.numAjax(a,this):""}),t.prev().click(function(){return r(this,!0),!1}),t.next().click(function(){return r(this,!1),!1}),t.val()>1&&t.prev().removeClass("Hui");var r=function(r,s){if(a||$(r).hasClass("Hui"))return!1;var o=t.val().match(/^\d+/);return o=o?o:"1",s?--o:++o,o>1?t.prev().removeClass("Hui"):function(){t.prev().addClass("Hui"),o=1}(),i?e.numAjax(o,r):t.val(o),!1}},numAjax:function(t,i){var a=$(i).parents("li").find("a.productUrl");return $(i).attr("data-val")==parseInt(t)?!1:void $.ajax({type:"POST",url:"/App_Services/CartProductProfile.asmx/UpdateShoppingcartNum",dataType:"json",contentType:"application/json;utf-8",data:"{url:'"+a.attr("href")+"',num:"+t+",viplevel:"+uGroup+",skuComId:'"+a.attr("data-productid")+"'}",timeout:1e4,beforeSend:function(){delayed=!0,$(".BuyYesUl .Buy_NumInput").attr("disabled","disabled")},complete:function(){delayed=!1,$(".BuyYesUl .Buy_NumInput").removeAttr("disabled")},error:function(){$(i).val($(i).attr("data-val")),alert("网络错误,请稍后重试。")},success:function(a){return $(i).parents("li").find(".Buy_NumInput").val(t),t>1&&$(i).parents("li").find(".Buy_NumLeft").removeClass("Hui"),$(i).attr("data-val",t),Product.goodsList.shopTotalPrice($(i).parents(".shopType")),!1}})}},goodsList:{init:function(){var t=sp_prol;return 0!=t.length?(this.shopType(t),this.loadHtml(this.Data),!1):($(".shopBuyGoodsYes").hide(),void $(".shopBuyGoodsNo").show())},Data:{},shopType:function(t){for(var i=0;i<t.length;i++)this.Data[t[i].Shop.Href]?this.Data[t[i].Shop.Href].push(t[i]):this.Data[t[i].Shop.Href]=[t[i]];return!1},loadHtml:function(t){if(0==t.length)return"";for(var i in t)for(var a=0;a<t[i].length;a++)0==a?$(".BuyYesTop").append(this.divHtml(t[i][a])):$(".BuyYesTop ul:last").append(this.liHtml(t[i][a]));return $(".BuyYesTop .shopType").each(function(t,i){var a=0;$("ul.BuyYesUl li",i).each(function(t,i){a+=parseFloat($(".BuyYes_Num",i).attr("data-pic"))*parseInt($(".Buy_NumInput",i).val())}),$(".BuyYes_Total span",i).text("￥"+a.toFixed(2))}),this.productNum(),!1},productNum:function(){return $(".shopBuyGoodsTitle").html("<em></em>您的购物车有"+$(".BuyYesTop .shopType li").length+"件商品"),!1},addLiHtml:function(t){var i=this;t=this.addShop.amendObj(t),$("#productImg img").attr("src",""==t.Thumbnail||null==t.Thumbnail?"http://sf.panli.com/FrontEnd/images20090801/noimg/noimg80.gif":t.Thumbnail).parent().css({opacity:0}).show(),$("#productImg").animate({opacity:1},200),$("#BuyYesUlLoad .BuyYesUlLoad").animate({marginTop:"-77px"},100,function(){i.queryId(t)?"":i.addShop.isShop(t)})},queryId:function(t){var i=this,a=!1,e=0;return $(".BuyYesTop .shopType").each(function(r,s){$(".BuyYesUl li",s).each(function(r,o){var u=$("a",o).attr("data-productid"),n=$("a",o).attr("href");u=u?u:"",t.SkuComId==u&&(t.ProductUrl==n||n.indexOf(t.ProductUrl)>=0)&&($(".BuyYesTop").animate({scrollTop:e+"px"},100,function(){i.addShop.productImg(function(){var a=parseInt($(o).find(".Buy_NumInput").val())+parseInt(t.BuyNum);$(o).find(".Buy_NumInput").val(a).attr("data-val",a),$(o).find(".Buy_NumInput").prev().removeClass("Hui");$(o).offset().top,$(".BuyYesTop").offset().top;i.shopTotalPrice(s)})}),a=!0)}),e+=$(s).height()}),a},addShop:{isShop:function(t){var i=!0,a="";$(".BuyYesTop .shopType").each(function(e,r){var s=$("ul",r).attr("data-url");t.Shop.ShopUrl==s&&(i=!1,a=r)}),i?this.notShop(t):this.beShop(t,a)},beShop:function(t,i){var a=this,e=$(".BuyYes_Total",i).offset().top,r=$(".BuyYesTop").offset().top,s=$(".BuyYesTop").offset().left;r-$("#productImg").offset().top+30,s-$("#productImg").offset().left;$(".BuyYesTop").animate({scrollTop:e-r+"px"},100),a.productImg(function(){var a=Product.goodsList.liHtml(t);a.css("height:0px"),$(".BuyYesUl",i).prepend(a),a.animate({height:"62px"},100),Product.goodsList.shopTotalPrice(i),Product.goodsList.productNum()})},notShop:function(t){var i=this,a=$(".BuyYesTop").offset().top,e=$(".BuyYesTop").offset().left;a-$("#productImg").offset().top,e-$("#productImg").offset().left;$(".BuyYesTop").animate({scrollTop:"0px"},100,function(){i.productImg(function(){var i=Product.goodsList.divHtml(t);i.css("height:0px"),$("#BuyYesUlLoad").after(i),i.animate({height:"107px"},300,function(){i.css("height","auto")}),Product.goodsList.productNum()})})},productImg:function(t){var i=$(".BuyYesTop").offset().top,a=$(".BuyYesTop").offset().left,e=i-$("#productImg").offset().top,r=a-$("#productImg").offset().left;$("#productImg").animate({top:e+"px",left:r+"px"},400,function(){$("#productImg").css({top:"0px",left:"0px",opacity:0}).hide(),"function"==typeof t?t():"",$("#DetailsCSubmit").removeAttr("disabled")})},amendObj:function(t){return t.Href=t.ProductUrl,t.Shop.Name=t.Shop.ShopName,t.Shop.Href=t.Shop.ShopUrl,t.Name=t.ProductName,t.PromotionPrice=t.payPrice,t}},divHtml:function(t){var i=t.Shop.Name,a=this;(null==i||""==i||i==t.Shop.Href)&&(i="----");var e=$('<div class="shopType"><div class="BuyYes_Total"><em title='+i+">"+i.substring(0,10)+"</em><span>￥"+(a.getDisPrice(t)*t.BuyNum).toFixed(2)+'</span></div><ul class="BuyYesUl" data-url="'+t.Shop.Href+'"></ul></div>');return $("ul",e).append(this.liHtml(t)),e},getDisPrice:function(t){var i=t.Price;return uGroup>0&&(i=t.VIPPrice4>0?t.VIPPrice4:t.VIPPrice3>0?t.VIPPrice3:t.VIPPrice2>0?t.VIPPrice2:t.VIPPrice1>0?t.VIPPrice1:t.Price),t.PromotionPrice>0&&(i=Math.min(i,t.PromotionPrice)),i},liHtml:function(t){var i=this,a=$('<li><a class="productUrl" data-productid="'+t.SkuComId+'" href="'+t.Href+'"><img src="'+(""==t.Thumbnail?"http://sf.panli.com/FrontEnd/images20090801/noimg/noimg80.gif":shearImg(62,t.Thumbnail))+'" title="'+t.Name+'" onerror="this.src=\'http://sf.panli.com/FrontEnd/images20090801/noimg/noimg80.gif\';"/></a><div class="BuyYes_title" title="'+t.SkuStr+'">'+t.SkuStr.substring(0,i._subStr(t.SkuStr))+'</div><div class="BuyYes_Num" data-pic="'+i.getDisPrice(t)+'"><span>￥'+i.getDisPrice(t).toFixed(2)+'</span><p class="Buy_Num"><a href="javascript:void(0);" class="Buy_NumLeft '+(t.BuyNum<=1?"Hui":"")+'">-</a><input type="text" maxlength="6" value="'+t.BuyNum+'" data-val="'+t.BuyNum+'" class="Buy_NumInput" /><a href="javascript:void(0);" class="Buy_NumRight">+</a></p></div><div class="clear"></div></li>');return Product.numbers.isNumbers($(".Buy_NumInput",a),!0,!0),a},_subStr:function(t){if(!t||0==t.length)return"";var i=t.match(/[\u4e00-\u9fa5]/g);return i=""!=i&&i?i.length:0,i+t.length},shopTotalPrice:function(t){var i=0;return $(".BuyYesUl li",t).each(function(t,a){i+=parseInt($(".Buy_NumInput",a).val())*parseFloat($(".BuyYes_Num",a).attr("data-pic"))}),$(".BuyYes_Total span",t).text("￥"+i.toFixed(2)),!1}},skuGroup:{skuData:{},skuType:function(t){for(var i=0;i<t.length;i++)this.skuData[t[i].TypeName]?this.skuData[t[i].TypeName].push(t[i]):this.skuData[t[i].TypeName]=[t[i]];return!1},init:function(){var t=Product.snatchData.Skus;return this.addInfo(),t&&"null"!=t&&0!=t.length?(this.isSku(),this.skuType(t),this.addmethod(),this.skuOne(),errorSku=this.errSku,this.skuAddHui(!0),void this.removeSkuid()):!1},addInfo:function(){var t=Product.snatchData.Description,i=$('<div class="zoomOut">'+t+"</div>");return $("img",i).each(function(t,i){""!=$(i).attr("data-original")&&$(i).attr("src",$(i).attr("data-original"))}),$("img",i).lazyload({effect:"fadeIn",placeholder:"http://sf.panli.com/FrontEnd/images20090801/Tools/Estimates/160px_160px.gif",handler:"undefined"!=$(".zoomOut").css("transformOrigin")?function(){$(".DetailsCTao_Con").css("height",.84*$(".DetailsCTao_Con").innerHeight())}:""}),$(".DetailsCTao_Con").append(i),!1},skuOne:function(){return $("#DetailsC_ConSku .DetailsC_Sku").each(function(t,i){1==$("ul li",i).length&&Product.skuGroup.liclick($("ul li",i),!0)}),!1},addSku:function(){var t="",i=this.skuData;for(var a in i){t+="<dd><span>"+a+'：</span><div class="DetailsC_Sku"><div class="DetailsCTi">请选择'+a+"</div><ul>";for(var e=0;e<i[a].length;e++)t+='<li data-skuid="'+i[a][e].SkuId+'"  data-img="'+i[a][e].PicUrl+'"><em></em><a href="#">'+i[a][e].PropertyName+"</a></li>";t+="</ul></div></dd>"}$("#SkuPerv").after(t)},skuAddHui:function(t){var i=[],a=this.errSku;if(0==a.length||1==$("#DetailsC_ConSku .DetailsC_Sku").length)return!1;$("#DetailsC_ConSku .DetailsC_Sku").each(function(t,a){$("li.on",a).length>0&&i.push($("li.on",a).attr("data-skuid"))});var e=this.examineId(i);return this.removeSku=t?e:[],$("#DetailsC_ConSku .DetailsC_Sku li").each(function(i,a){if(!$(a).hasClass("on")){var r=$(a).attr("data-skuid");t?$.inArray(r,e)>=0?$(a).remove():"":$.inArray(r,e)>=0?$(a).addClass("hui"):$(a).removeClass("hui")}}),!1},errSku:[],okSku:[],isSku:function(){var t=Product.snatchData.SkuCombinations;if(!t||0==t.length)return!1;for(var i=0;i<t.length;i++)t[i].Quantity<=0?this.errSku.push(t[i]):this.okSku.push(t[i]);return!1},removeSkuid:function(){for(var t=this.removeSku,i=this.errSku,a=[],e=0,r=i.length;r>e;e++)!$.inArray(i[e],t)>=0&&a.push(i[e]);this.errSku=a},examineId:function(t){var i=(this.errSku,this.okSku),a=this.query,e=[],r=this.skuData;for(var s in r){for(var o=t.slice(0),u=0,n=r[s].length;n>u;u++)for(var l=0,c=t.length;c>l;l++)if(r[s][u].SkuId==t[l]){o.splice(l,1);break}for(var u=0,n=r[s].length;n>u;u++){var d=o.slice(0);d.push(r[s][u].SkuId);for(var h=!1,p=0,m=i.length;m>p;p++){var f=i[p].SkuIds;if(a.inArray(d,f)){h=!0;break}}h||e.push(r[s][u].SkuId)}}return e},query:{inArray:function(t,i){if(""==t||!t||!i||""==i)return!1;for(var a=t.length>i.length?t:i,e=t.length>i.length?i:t,r=0;r<e.length;r++)if($.inArray(e[r],a)<0)return!1;return!0},isSameType:function(t,i){var a=Product.skuGroup.skuData;for(var e in a){for(var r=!1,s=!1,o=0;o<a[e].length;o++)$.inArray(a[e][o].SkuId,t)>=0&&(r=!0),a[e][o].SkuId==i&&(s=!0);if(r&&s)return!0}return!1},skuConId:function(t){if(!t||0==t.length)return"";var i=Product.snatchData.SkuCombinations;if(0==i.length||!i)return!1;for(var a=0;a<i.length;a++){var e=i[a].SkuIds;if(this.inArray(e,t))return i[a]}return""},delRepeat:function(t){for(var i=[],a=0;a<t.length;a++)$.inArray(t[a],i)<0&&i.push(t[a]);return i}},price:function(){var t=[],i=!1,a=$("#DetailsC_ConSku");if($(".DetailsC_Sku",a).each(function(a,e){$("li.on",e).length>0?t.push($("li.on",e).attr("data-skuid")):i=!0}),i)return!1;var e=this.query.skuConId(t);if(""==e)return!1;var r=this.discount(e),s=e.Price,o=e.Promo_Price;return Product.snatchData.Price=s,o=0==o||Product.snatchData.DiscountExpiredDate<=0?s:o,r=0==r?s:r,s=Math.min(s,o),r=Math.min(s,r),0>=s||!s?!1:($(".DetailsC_Mon",a).text("￥"+s.toFixed(2)),void(Product.snatchData.payPrice=r))},discount:function(t){var i=vipDisc,a=t.Price;uGroup>0&&(i=i.v4>0||"flanbian"==$("#txtUserName").val()?i.v4:i.v3>0?i.v3:i.v2>0?i.v2:i.v1>0?i.v1:0,t.Vip1Price=t.Vip1Price>0?t.Vip1Price*a:t.Vip1Price,t.Vip2Price=t.Vip2Price>0?t.Vip2Price*a:t.Vip2Price,t.Vip3Price=t.Vip3Price>0?t.Vip3Price*a:t.Vip3Price,t.Vip4Price=t.Vip4Price>0?t.Vip4Price*a:t.Vip4Price);var e=t.Promo_Price<=0||Product.snatchData.DiscountExpiredDate<=0?a:t.Promo_Price,r=0;return i>0&&(r=a*i),e>r&&0!=r?($("#VIPPrice").show(),$("#VIPPrice em").text("￥"+r.toFixed(2))):$("#VIPPrice").hide(),r},dataImg:function(t){var i=$(t).attr("data-img");if(""!=i){var a=shearImg(250,i);$("#JqzoomImg").attr("src",a),$(".DetailsC_ConImgMin li.on").removeClass("on").find(".zoomThumbActive").removeClass("zoomThumbActive"),$(".zoomWrapperImage img").attr("src",i)}return!1},addmethod:function(){var t="#DetailsC_ConSku",i=this;this.errSku;$(".DetailsC_Sku li",t).click(function(){return i.liclick(this),!1})},liclick:function(t,i){return $(t).hasClass("hui")?!1:($(t).hasClass("on")?$(t).removeClass("on"):($(t).parents("div.DetailsC_Sku").find(".DetailsCTi").hide(),$(t).addClass("on").siblings("li.on").removeClass("on"),i?"":this.dataImg(t)),this.skuAddHui(),this.price(),!1)}},method:function(){var t="#DetailsC_ConSku",i=this;$(".DetailsC_Textarea",t).focus(function(){(0==$.trim($(this).val()).length||$(this).hasClass("DetailsC_TextareaHui"))&&$(this).removeClass("DetailsC_TextareaHui")}).blur(function(){0==$.trim($(this).val()).length&&$(this).addClass("DetailsC_TextareaHui")});var a=$("#notProductPrice");a.length>0&&(Product.numbers.digital({dom:a[0],price:!0}),a.focus(function(){$(this).hasClass("amc_red")&&$(this).removeClass("amc_red").val("")}).blur(function(){0==$.trim(this.value).length&&$(this).addClass("amc_red").val("请填写商品价格")}),"请填写商品价格"!=a.val()&&a.hasClass("amc_red")&&$(this).removeClass("amc_red"));var a=$("#DetailsC_Freight");a.length>0&&(Product.numbers.digital({dom:a[0],price:!0}),a.focus(function(){$(this).hasClass("amc_red")&&$(this).removeClass("amc_red").val("")}).blur(function(){0==$.trim(this.value).length&&$(this).addClass("amc_red").val("请填写运费")}),"请填写运费"!=a.val()&&a.hasClass("amc_red")&&$(this).removeClass("amc_red"));var e=$("#notProductName");e.length>0&&(e.focus(function(){$(this).hasClass("amc_red")&&$(this).removeClass("amc_red").val("")}).blur(function(){0==$.trim(this.value).length&&$(this).addClass("amc_red").val("请填写商品名称")}),"请填写商品名称"!=e.val()&&a.hasClass("amc_red")&&$(this).removeClass("amc_red")),$("#DetailsCSubmit").click(function(){return i.addSubmit(this),!1}),$(".DetailsC_ConImgMin li").mouseover(function(){$(this).addClass("on").siblings(".on").removeClass("on")}),this.numbers.isNumbers($("#DetailsC_ConSku .Buy_Num input"),!0)},addSubmitMess:function(t){this.skuGroup.okSku;Product.snatchData.Remark=$.trim($(".DetailsC_Textarea").val()),Product.snatchData.BuyNum=t},addSubmit:function(){var t=$("#notProductName");if(t.length>0){var i=$.trim(t.val());if(0==i.length||t.hasClass("amc_red"))return!1;Product.snatchData.ProductName=i}var a=$("#notProductPrice");if(a.length>0){var e=parseFloat($("#notProductPrice").val());if(a.hasClass("amc_red"))return alert("请填写商品价格"),!1;if(isNaN(e)||0==e)return alert("商品价格格式错误,请重新提交。"),!1;Product.snatchData.Price=e}var r=$("#DetailsC_Freight");if(r.length>0&&!r.attr("disabled")){var s=parseFloat(r.val());if(r.hasClass("amc_red"))return alert("请填写运费价格"),!1;if(isNaN(s))return alert("运费价格格式错误,请重新提交。"),!1;Product.snatchData.Freight=s}var o="#DetailsC_ConSku",u=[],n=!1,l="";if($(".DetailsC_Sku",o).each(function(t,i){$("li.on",i).length>0?(l+=(""==l?"":" ")+$("li.on a",i).text(),u.push($("li.on",i).attr("data-skuid"))):($(".DetailsCTi",i).show(),n=!0)}),n)return!1;var c=$("#DetailsC_ConSku .Buy_Num input").val();if(!/^(0+)?[1-9](\d+)?$/.test(c))return alert("商品数量提交异常,请重新提交。"),$("#DetailsC_ConSku .Buy_Num input").val(1),!1;this.addSubmitMess(c),Product.snatchData.DiscountExpiredDate=Product.snatchData.ClientDate;var d=this.skuGroup.query.skuConId(u);return d=""==d?"":d.CombinationId,Product.snatchData.Description="",""==d&&""!=l?(alert("当前商品无库存，请重新选择。"),!1):void this.submitAjax(d,l)},submitAjax:function(t,i){var a=Product.snatchData.payPrice,e=Product.snatchData;$.ajax({type:"POST",url:"/App_Services/wsAddItem.asmx/AddToShoppingCart",dataType:"json",contentType:"application/json;utf-8",data:JSON.stringify({json:JSON.stringify(Product.snatchData),skuStr:i,skuComId:t}),timeout:2e4,beforeSend:function(){0==$(".BuyYesTop .shopType").length&&($(".shopBuyGoodsYes").show(),$(".shopBuyGoodsNo").hide()),$("#BuyYesUlLoad .BuyYesUlLoad").animate({marginTop:"0px"},100),$("#DetailsCSubmit").attr("disabled","disabled")},complete:function(){},error:function(){alert("网络错误，请稍后再试"),$(".BuyYesTop .shopType").length<=0&&($(".shopBuyGoodsYes").hide(),$(".shopBuyGoodsNo").show()),$("#BuyYesUlLoad .BuyYesUlLoad").animate({marginTop:"-77px"},100),$("#DetailsCSubmit").removeAttr("disabled")},success:function(r){r=r.d||r,e.SkuComId=t,e.SkuStr=i,e.Price=0!=a&&a?a:e.Price>e.DiscountPrice&&e.DiscountPrice>0?e.DiscountPrice:e.Price,""==r.Error?Product.goodsList.addLiHtml(Product.snatchData):function(){$(".BuyYesTop .shopType").length<=0&&($(".shopBuyGoodsYes").hide(),$(".shopBuyGoodsNo").show()),$("#BuyYesUlLoad .BuyYesUlLoad").animate({marginTop:"-77px"},100),$("#DetailsCSubmit").removeAttr("disabled"),alert("添加购物车失败！")}()}})}};